<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>ポチャッコのわくわく家計簿</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <header class="header">
    <h1>🐾 ポチャッコのわくわく家計簿</h1>
    <p>写真を撮るだけ、かんたん家計管理</p>
    <button class="btn-camera-top" onclick="go('camera')" aria-label="撮影">📷</button>
  </header>

  <!-- ===== HOME ===== -->
  <div id="page-home" class="page active">
    <div class="pochacco-area">
      <svg class="pochacco-svg" viewBox="0 0 120 120">
        <ellipse cx="60" cy="112" rx="18" ry="5" fill="#e8e8e8" />
        <circle cx="60" cy="60" r="36" fill="#fff" stroke="#555" stroke-width="1.8" />
        <ellipse cx="32" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(-15 32 34)" />
        <ellipse cx="88" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(15 88 34)" />
        <ellipse cx="58" cy="26" rx="20" ry="8" fill="#7ECBE6" />
        <circle cx="58" cy="20" r="4.5" fill="#7ECBE6" />
        <circle cx="48" cy="56" r="3.5" fill="#333" />
        <circle cx="72" cy="56" r="3.5" fill="#333" />
        <circle cx="49.2" cy="54.5" r="1.3" fill="#fff" />
        <circle cx="73.2" cy="54.5" r="1.3" fill="#fff" />
        <ellipse cx="60" cy="65" rx="4.5" ry="3" fill="#333" />
        <path d="M54 69Q60 75 66 69" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="38" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
        <circle cx="82" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
      </svg>
      <div class="speech-bubble" id="pochacco-msg"></div>
    </div>
    <div class="month-sel">
      <button onclick="changeMonth(-1)">◀</button>
      <span class="month-label" id="ml"></span>
      <button onclick="changeMonth(1)">▶</button>
    </div>
    <div class="cards" id="sum-cards"></div>
    <div class="section" id="cat-section">
      <h2>📊 カテゴリ別</h2>
      <div id="cat-bars"></div>
    </div>
    <div class="section">
      <h2>📋 最近の記録</h2>
      <div id="recent-list"></div>
    </div>
  </div>

  <!-- ===== CAMERA ===== -->
  <div id="page-camera" class="page">
    <div class="pochacco-area">
      <svg class="pochacco-svg" viewBox="0 0 120 120">
        <ellipse cx="60" cy="112" rx="18" ry="5" fill="#e8e8e8" />
        <circle cx="60" cy="60" r="36" fill="#fff" stroke="#555" stroke-width="1.8" />
        <ellipse cx="32" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(-15 32 34)" />
        <ellipse cx="88" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(15 88 34)" />
        <ellipse cx="58" cy="26" rx="20" ry="8" fill="#7ECBE6" />
        <circle cx="58" cy="20" r="4.5" fill="#7ECBE6" />
        <circle cx="48" cy="56" r="3.5" fill="#333" />
        <circle cx="72" cy="56" r="3.5" fill="#333" />
        <circle cx="49.2" cy="54.5" r="1.3" fill="#fff" />
        <circle cx="73.2" cy="54.5" r="1.3" fill="#fff" />
        <ellipse cx="60" cy="65" rx="4.5" ry="3" fill="#333" />
        <path d="M54 69Q60 75 66 69" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="38" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
        <circle cx="82" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
      </svg>
      <div class="speech-bubble" id="cam-msg">レシートを撮影してね！📸</div>
    </div>
    <div class="camera-area">
      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
        <div class="up-icon">📄</div>
        <p>タップしてレシート画像を選択</p>
        <input type="file" id="file-input" accept="image/*">
      </div>
      <img id="cam-preview" class="receipt-preview" style="display:none" alt="プレビュー">
      <div class="camera-btns">
        <button class="btn-cam" onclick="document.getElementById('cam-input').click()">📷 カメラで撮影<input type="file"
            id="cam-input" accept="image/*" capture="environment" style="display:none"></button>
        <button class="btn-file" onclick="document.getElementById('file-input').click()">📁 ファイル選択</button>
      </div>
      <div class="processing" id="processing" style="display:none">
        <div class="spinner"></div>
        <p style="font-size:.85rem;color:var(--text-dim)">AIが読み取り中...</p>
      </div>
      <button class="btn-primary" id="btn-manual" style="margin-top:14px" onclick="openManual()">✏️ 手入力で追加</button>
    </div>
  </div>

  <!-- ===== RESULT ===== -->
  <div id="page-result" class="page">
    <div class="pochacco-area">
      <svg class="pochacco-svg" viewBox="0 0 120 120">
        <ellipse cx="60" cy="112" rx="18" ry="5" fill="#e8e8e8" />
        <circle cx="60" cy="60" r="36" fill="#fff" stroke="#555" stroke-width="1.8" />
        <ellipse cx="32" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(-15 32 34)" />
        <ellipse cx="88" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(15 88 34)" />
        <ellipse cx="58" cy="26" rx="20" ry="8" fill="#7ECBE6" />
        <circle cx="58" cy="20" r="4.5" fill="#7ECBE6" />
        <circle cx="48" cy="56" r="3.5" fill="#333" />
        <circle cx="72" cy="56" r="3.5" fill="#333" />
        <circle cx="49.2" cy="54.5" r="1.3" fill="#fff" />
        <circle cx="73.2" cy="54.5" r="1.3" fill="#fff" />
        <ellipse cx="60" cy="65" rx="4.5" ry="3" fill="#333" />
        <path d="M54 69Q60 75 66 69" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="38" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
        <circle cx="82" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
      </svg>
      <div class="speech-bubble" id="result-msg">読み取り完了！確認してね ✨</div>
    </div>
    <div class="form-wrap">
      <div class="fg"><label>📅 日付</label><input type="date" id="r-date"></div>
      <div class="fg"><label>🏪 店名</label><input type="text" id="r-store" placeholder="例: セブンイレブン"></div>
      <div class="fg"><label>💰 合計金額（円）</label><input type="number" id="r-amount" placeholder="例: 1280" min="0"
          inputmode="numeric"></div>
      <div class="fg"><label>📁 カテゴリ</label>
        <div class="cat-chips" id="r-cats"></div>
      </div>
      <div class="fg" id="r-items-wrap" style="display:none"><label>📝 品目</label>
        <div class="items-list" id="r-items"></div>
      </div>
      <button class="btn-primary" onclick="saveResult()">✅ 保存する</button>
      <button class="btn-secondary" onclick="go('camera')">📷 もう1枚撮影する</button>
    </div>
  </div>

  <!-- ===== HISTORY ===== -->
  <div id="page-history" class="page">
    <div class="search-bar"><input type="text" id="search-input" placeholder="店名で検索..." oninput="renderHistory()"></div>
    <div class="filter-chips" id="filter-chips"></div>
    <div class="section">
      <div id="history-list"></div>
    </div>
  </div>

  <!-- ===== ANALYSIS ===== -->
  <div id="page-analysis" class="page">
    <div class="month-sel">
      <button onclick="changeMonth(-1)">◀</button>
      <span class="month-label" id="ml2"></span>
      <button onclick="changeMonth(1)">▶</button>
    </div>
    <div class="chart-container">
      <h3>📊 カテゴリ別内訳</h3><canvas id="pie-chart"></canvas>
    </div>
    <div class="chart-container">
      <h3>📈 月別推移（過去6ヶ月）</h3><canvas id="bar-chart"></canvas>
    </div>
    <div class="insight-card" id="insights">
      <h3>💡 分析・アドバイス</h3>
      <div id="insight-body"></div>
    </div>
  </div>

  <!-- ===== SETTINGS ===== -->
  <div id="page-settings" class="page">
    <div class="pochacco-area">
      <svg class="pochacco-svg" viewBox="0 0 120 120">
        <ellipse cx="60" cy="112" rx="18" ry="5" fill="#e8e8e8" />
        <circle cx="60" cy="60" r="36" fill="#fff" stroke="#555" stroke-width="1.8" />
        <ellipse cx="32" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(-15 32 34)" />
        <ellipse cx="88" cy="34" rx="10" ry="16" fill="#fff" stroke="#555" stroke-width="1.8"
          transform="rotate(15 88 34)" />
        <ellipse cx="58" cy="26" rx="20" ry="8" fill="#7ECBE6" />
        <circle cx="58" cy="20" r="4.5" fill="#7ECBE6" />
        <circle cx="48" cy="56" r="3.5" fill="#333" />
        <circle cx="72" cy="56" r="3.5" fill="#333" />
        <circle cx="49.2" cy="54.5" r="1.3" fill="#fff" />
        <circle cx="73.2" cy="54.5" r="1.3" fill="#fff" />
        <ellipse cx="60" cy="65" rx="4.5" ry="3" fill="#333" />
        <path d="M54 69Q60 75 66 69" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round" />
        <circle cx="38" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
        <circle cx="82" cy="64" r="5.5" fill="#FFB6C1" opacity=".35" />
      </svg>
      <div class="speech-bubble">設定を変更できるよ ⚙️</div>
    </div>
    <div class="set-card">
      <h3>🔑 Gemini APIキー</h3>
      <p>レシートのAI読み取りに必要です。<br><a href="https://aistudio.google.com/apikey" target="_blank"
          style="color:var(--primary-dark)">こちら</a>から無料で取得できます。</p>
      <div class="fg"><input type="password" id="s-apikey" placeholder="APIキーを入力..."></div>
      <button class="btn-export" onclick="saveApiKey()">保存</button>
    </div>
    <div class="set-card">
      <h3>💰 月の予算設定</h3>
      <p>予算を設定すると残り金額が表示されます。</p>
      <div class="fg"><input type="number" id="s-budget" placeholder="例: 50000" min="0" inputmode="numeric"></div>
      <button class="btn-export" onclick="saveBudget()">保存</button>
    </div>
    <div class="set-card">
      <h3>📤 データエクスポート</h3>
      <p>CSVまたはJSONでダウンロード。</p>
      <div style="display:flex;gap:8px">
        <button class="btn-export" onclick="exportCSV()">CSV</button>
        <button class="btn-export" onclick="exportJSON()">JSON</button>
      </div>
    </div>
    <div class="set-card">
      <h3>📥 データインポート</h3>
      <p>バックアップしたJSONファイルから復元。</p>
      <button class="btn-export" onclick="document.getElementById('import-input').click()">インポート</button>
      <input type="file" id="import-input" accept=".json" style="display:none">
    </div>
    <div class="set-card">
      <h3>🗑️ データ削除</h3>
      <p>すべてのデータを削除します。</p>
      <button class="btn-danger" onclick="confirmDeleteAll()">全データ削除</button>
    </div>
    <div class="set-card">
      <h3>ℹ️ このアプリについて</h3>
      <p>ポチャッコのわくわく家計簿 v1.0<br>データはブラウザ内に保存されます。<br>サーバーへの送信はありません。</p>
    </div>
  </div>

  <!-- Nav -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-p="home"><span class="icon">🏠</span>ホーム</button>
    <button class="nav-btn" data-p="camera"><span class="icon">📷</span>撮影</button>
    <button class="nav-btn" data-p="history"><span class="icon">📋</span>履歴</button>
    <button class="nav-btn" data-p="analysis"><span class="icon">📊</span>分析</button>
    <button class="nav-btn" data-p="settings"><span class="icon">⚙️</span>設定</button>
  </nav>

  <!-- Confirm -->
  <div class="confirm-bg" id="confirm-bg">
    <div class="confirm-box">
      <p id="confirm-msg"></p>
      <div class="confirm-acts"><button class="btn-cancel" onclick="closeConfirm()">キャンセル</button><button
          class="btn-conf-del" id="btn-conf">削除</button></div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal-bg" id="edit-bg" onclick="if(event.target===this)closeEdit()">
    <div class="modal">
      <div class="modal-handle"></div>
      <h2 id="edit-title">支出を編集</h2>
      <div class="form-wrap">
        <div class="fg"><label>📅 日付</label><input type="date" id="e-date"></div>
        <div class="fg"><label>🏪 店名</label><input type="text" id="e-store"></div>
        <div class="fg"><label>💰 金額</label><input type="number" id="e-amount" min="0" inputmode="numeric"></div>
        <div class="fg"><label>📁 カテゴリ</label>
          <div class="cat-chips" id="e-cats"></div>
        </div>
        <button class="btn-primary" onclick="saveEdit()">保存</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="app.js"></script>
</body>

</html>